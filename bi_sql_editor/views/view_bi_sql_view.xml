<?xml version="1.0" encoding="UTF-8"?>
<!--
Copyright (C) 2017 - Today: GRAP (http://www.grap.coop)
@author Sylvain LE GAL (https://twitter.com/legalsylvain)
License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl.html).
-->

<openerp><data>

    <record id="view_bi_sql_view_tree" model="ir.ui.view">
        <field name="model">bi.sql.view</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="technical_name"/>
                <field name="size"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record id="view_bi_sql_view_form" model="ir.ui.view">
        <field name="model">bi.sql.view</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="button_create_sql_view" type="object" states="draft" string="Create SQL View" class="oe_highlight"
                        help="This will try to create an SQL View, based on the SQL request"/>
                    <button name="button_update_registry" type="object" states="sql_view_created"
                        string="Update Registry (and create Index)" class="oe_highlight"
                        help="This will updated the registry, and create Index, depending of the fields setting"/>
                    <button name="button_create_ui" type="object" states="registry_updated" string="Create UI"
                        class="oe_highlight" help="This will create Odoo View, Action and Menu"/>
                    <button name="button_refresh_materialized_view" type="object" string="Refresh Materialized View"
                        attrs="{'invisible': ['|', ('state', 'in', ('draft')), ('is_materialized', '=', False)]}"
                        help="this will refresh the materialized view"/>
                    <button name="button_open_view" type="object" string="Open View" class="oe_highlight"
                        attrs="{'invisible': [('state', 'not in', ('ui_created'))]}" />
                    <button name="button_set_draft" type="object" states="sql_view_created,registry_updated,ui_created"
                        string="Reset to Draft"
                        confirm="Are you sure you want to set to draft this SQL View. It will delete
                        the materialized view, and all the previous mapping realized with the columns"/>
                    <field name="state" widget="statusbar" />
                </header>
                <sheet>
                    <h1>
                        <field name="name" attrs="{'readonly': [('state','=','created')]}" colspan="4"/>
                    </h1>
                    <group>
                        <group>
                            <group>
                                <field name="technical_name"/>
                                <field name="is_materialized"/>
                                <field name="size"
                                    attrs="{'invisible': ['|', ('state', '=', 'draft'), ('is_materialized', '=', False)]}"/>
                                <field name="model_id" attrs="{'invisible': [('state', '=', 'draft')]}"/>
                                <field name="cron_id"
                                    attrs="{'invisible': ['|', ('state', '=', 'draft'), ('is_materialized', '=', False)]}"/>
                            </group>
                            <group string="User Interface" attrs="{'invisible': [('state', '!=', 'ui_created')]}">
                                <field name="view_id"/>
                                <field name="action_id"/>
                                <field name="menu_id"/>
                            </group>
                        </group>
                    </group>
                    <notebook>
                        <page string="SQL Fields" attrs="{'invisible': [('state', '=', 'draft')]}">
                            <field name="bi_sql_field_ids" nolabel="1" colspan="4">
                                <tree editable="bottom" colors="blue:field_id==False">
                                    <field name="sequence"/>
                                    <field name="name"/>
                                    <field name="sql_type"/>
                                    <field name="field_id"/>
                                    <button name="%(action_bi_sql_field_wizard)d"
                                       string="Create Field" type="action" icon="gtk-add"
                                        attrs="{'invisible': [('field_id', '!=', False)]}"/>
                                    <field name="is_index"/>
                                    <field name="graph_type"/>
                                </tree>
                            </field>
                        </page>
                        <page string="SQL Query">
                            <field name="sql_request" nolabel="1" colspan="4"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

</data></openerp>
